tsv = <<~TSV
25613	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25614	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25615	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25616	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25617	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25618	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25619	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25620	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25634	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25635	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25621	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25622	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25624	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25623	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25625	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25707	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25712	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25708	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25709	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25702	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25713	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25703	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25714	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25705	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25706	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25704	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25710	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25711	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25715	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25676	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25953	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25667	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25954	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25955	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25952	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25956	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25725	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25664	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25665	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25666	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25724	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25693	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25690	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25695	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26231	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26232	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26233	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25834	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26125	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25755	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26234	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25880	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25835	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25737	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25761	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25751	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25833	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25881	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26235	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25756	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25764	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25701	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25700	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25691	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25699	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25698	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25913	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26213	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26257	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26354	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26228	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25804	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25646	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26080	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26254	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26065	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26148	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26241	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26264	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
25797	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
26404	Different versions were recorded under the same catalogue number in editions prior to BWV-3.	rdau:P60313
TSV

mc = MarcConfigCache.get_configuration("work")

rows = CSV.parse(tsv, col_sep: "\t", headers: %i[id note property]) 

rows.each do |r|
  old = Work.find(r[:id])

  new_work = Work.new

  new_marc = MarcWork.new(old.marc.marc_source)
  # Reset the basic fields to default values
  new_marc.first_occurance("001").content = "__TEMP__"

  n530 = MarcNode.new("work", "530", "", mc.get_default_indicator("530"))
  n530.add_at(MarcNode.new("work", "0", r[:id], nil), 0 )
  n530.add_at(MarcNode.new("work", "g", r[:note], nil), 0 )
  n530.add_at(MarcNode.new("work", "i", r[:property], nil), 0 )
  new_marc.root.add_at(n530, new_marc.get_insert_position("530") )

    # Import the marc
  new_marc.suppress_scaffold_links
  new_marc.import
  
  # Attach it to the child
  new_work.marc = new_marc  
  # Save the holding
  new_work.suppress_reindex
  new_work.composer = old.composer
  
  new_work.save
  puts new_work.id
end

# Obsoletize the old ones
rows.each do |r|
  old = Work.find(r[:id])

  old.wf_audit = :obsolete
  old.save
end